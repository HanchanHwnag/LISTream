
CREATE
  TABLE favorite
  (
    favorite_code  INTEGER NOT NULL ,
    user_info_code INTEGER NOT NULL ,
    playlist_code  INTEGER NOT NULL
  ) ;
ALTER TABLE favorite ADD CONSTRAINT favorite_PK PRIMARY KEY ( favorite_code ) ;


CREATE
  TABLE genre
  (
    genre_code INTEGER NOT NULL ,
    genre_name VARCHAR2 (100)
  ) ;
ALTER TABLE genre ADD CONSTRAINT genre_PK PRIMARY KEY ( genre_code ) ;


CREATE
  TABLE music
  (
    music_code    INTEGER NOT NULL ,
    artist        VARCHAR2 (100) ,
    music_title   VARCHAR2 (100) ,
    playtime      VARCHAR2 (100) ,
    path          VARCHAR2 (100) ,
    music_hit     INTEGER ,
    music_regdate DATE ,
    genre_code    INTEGER NOT NULL
  ) ;
ALTER TABLE music ADD CONSTRAINT music_PK PRIMARY KEY ( music_code ) ;


CREATE
  TABLE musiclist
  (
    musiclist_code INTEGER NOT NULL ,
    music_code     INTEGER NOT NULL ,
    playlist_code  INTEGER NOT NULL
  ) ;


CREATE
  TABLE playlist
  (
    playlist_code  INTEGER NOT NULL ,
    user_info_code INTEGER NOT NULL ,
    playlist_title VARCHAR2 (100) ,
    hit            INTEGER ,
    regdate        DATE ,
    theme_code     INTEGER NOT NULL
  ) ;
ALTER TABLE playlist ADD CONSTRAINT playlist_PK PRIMARY KEY ( playlist_code ) ;


CREATE
  TABLE reply
  (
    reply_code     INTEGER NOT NULL ,
    content        VARCHAR2 (100) ,
    regdate        DATE ,
    user_info_code INTEGER NOT NULL ,
    playlist_code  INTEGER NOT NULL
  ) ;
ALTER TABLE reply ADD CONSTRAINT reply_PK PRIMARY KEY ( reply_code ) ;


CREATE
  TABLE theme
  (
    theme_code INTEGER NOT NULL ,
    theme_name VARCHAR2 (100)
  ) ;
ALTER TABLE theme ADD CONS
TRAINT theme_PK PRIMARY KEY ( theme_code ) ;


CREATE
  TABLE user_info
  (
    user_info_code INTEGER NOT NULL ,
    id             VARCHAR2 (100) ,
    pwd            VARCHAR2 (100) ,
    name           VARCHAR2 (100) ,
    email          VARCHAR2
    --  ERROR: VARCHAR2 size not specified
  ) ;
ALTER TABLE user_info ADD CONSTRAINT user_info_PK PRIMARY KEY ( user_info_code
) ;


ALTER TABLE favor
ite ADD CONSTRAINT favorite_playlist_FK FOREIGN KEY (
playlist_code ) REFERENCES playlist ( playlist_code ) ON
DELETE CASCADE ;

ALTER TABLE favorite ADD CONSTRAINT favorite_user_info_FK FOREIGN KEY (
user_info_code ) REFERENCES user_info ( user_info_code ) ON
DELETE CASCADE ;

ALTER TABLE music ADD CONSTRAINT music_genre_FK FOREIGN KEY ( genre_code )
REFERENCES genre ( genre_code ) ;

ALTER TABLE musiclist ADD CONSTRAINT musiclist_music_FK FOREIGN KEY (
music_code ) REFERENCES music ( music_code ) ON
DELETE CASCADE ;

ALTER TABLE musiclist ADD CONSTRAINT musiclist_playlist_FK FOREIGN KEY (
playlist_code ) REFERENCES playlist ( playlist_code ) ON
DELETE CASCADE ;

ALTER TABLE playlist ADD CONSTRAINT playlist_theme_FK FOREIGN KEY ( theme_code
) REFERENCES theme ( theme_code ) ;

ALTER TABLE playlist ADD CONSTRAINT playlist_user_info_FK FOREIGN KEY (
user_info_code ) REFERENCES user_info ( user_info_code ) ON
DELETE CASCADE ;

ALTER TABLE reply ADD CONSTRAINT reply_playlist_FK FOREIGN KEY ( playlist_code
) REFERENCES playlist ( playlist_code ) ON
DELETE CASCADE ;

ALTER TABLE reply ADD CONSTRAINT reply_user_info_FK FOREIGN KEY (
user_info_code ) REFERENCES user_info ( user_info_code ) ON
DELETE CASCADE ;

CREATE OR REPLACE TRIGGER add_trigger
AFTER INSERT ON musiclist
FOR EACH ROW
BEGIN
  update music set music_hit = music_hit + 1 where music_code = :new.music_code;
END;

CREATE OR REPLACE TRIGGER minus_trigger
AFTER delete ON musiclist
FOR EACH ROW
BEGIN
  update music set music_hit = music_hit - 1 where music_code = :old.music_code;
END;

CREATE OR REPLACE TRIGGER playlist_add_trigger
AFTER INSERT ON favorite
FOR EACH ROW
BEGIN
  update playlist set hit = hit + 1 where playlist_code = :new.playlist_code;
END;

CREATE OR REPLACE TRIGGER playlist_minus_trigger
AFTER delete ON favorite
FOR EACH ROW
BEGIN
  update playlist set hit = hit - 1 where playlist_code = :old.playlist_code;
END;
